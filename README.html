<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Loghi Sittard Archive Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Chosen Palette: Warm Neutrals with Subtle Blue Accent */
        /* Application Structure Plan: Tabbed interface (Overview, Prerequisites, Setup, Docker Wrapper Hub, Models, Troubleshooting, Advanced). Docker Wrapper Hub is the core interactive section with .env explorer, workflow visualizer, and command reference. Chosen for non-linear exploration of technical documentation. */
        /* Visualization & Content Choices:
            - README Text -> Formatted text blocks, lists. Goal: Inform. Method: HTML, Tailwind.
            - Code Snippets -> Preformatted blocks with copy buttons. Goal: Usability. Method: HTML, JS.
            - Workflow -> HTML/CSS diagram. Goal: Understand process. Method: Tailwind flex/grid.
            - .env Variables -> Interactive list/details. Goal: Configuration aid. Method: HTML, JS.
            - Troubleshooting -> Expandable sections. Goal: Problem solving. Method: HTML, JS.
            - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. No direct charts from README content. */
        /* CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. */

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            color: #292524; /* stone-800 */
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-color: #2563eb; /* blue-600 */
            color: #2563eb; /* blue-600 */
            background-color: #eff6ff; /* blue-50 */
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .code-block {
            background-color: #1f2937; /* gray-800 */
            color: #e5e7eb; /* gray-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #3b82f6; /* blue-500 */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #2563eb; /* blue-600 */
        }
        .info-box {
            background-color: #eff6ff; /* blue-50 */
            border-left-width: 4px;
            border-color: #2563eb; /* blue-600 */
            padding: 1rem;
            border-radius: 0.25rem;
        }
        .troubleshooting-item summary {
            cursor: pointer;
            font-weight: 600;
            padding: 0.5rem;
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }
         .troubleshooting-item summary:hover {
            background-color: #d1d5db; /* gray-300 */
        }
        .troubleshooting-item[open] summary {
            background-color: #bfdbfe; /* blue-200 */
        }
        .workflow-step {
            border: 2px solid #93c5fd; /* blue-300 */
            background-color: #eff6ff; /* blue-50 */
            padding: 0.75rem;
            border-radius: 0.375rem;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .workflow-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem; /* 24px */
            color: #60a5fa; /* blue-400 */
            margin: 0 0.5rem;
        }
        .env-var-item {
            cursor: pointer;
        }
        .env-var-item:hover {
            background-color: #f0f9ff; /* sky-50 */
        }
        .env-var-details {
            background-color: #e0f2fe; /* sky-100 */
            border: 1px solid #7dd3fc; /* sky-300 */
        }

        /* Ensure Inter font is loaded if available, otherwise fallback */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-stone-900">Interactive Loghi Sittard Archive Guide</h1>
            <p class="text-stone-600 mt-2">An easy-to-navigate guide for setting up and using the Loghi HTR pipeline.</p>
        </header>

        <div class="bg-white shadow-xl rounded-lg p-4 sm:p-6 md:p-8">
            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex flex-wrap gap-x-2 gap-y-2" aria-label="Tabs">
                    <button class="tab-button active whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="overview">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM8.5 6.5a.75.75 0 00-1.5 0v7a.75.75 0 001.5 0v-7zm3 0a.75.75 0 00-1.5 0v7a.75.75 0 001.5 0v-7zm2.25.75a.75.75 0 010 1.5H15v5.508a2.501 2.501 0 00-1.352-2.165l-.87-.518a.75.75 0 00-.756 1.298l.87.518A3.997 3.997 0 0113.5 15.75V16.5a.75.75 0 01-1.5 0v-.75a2.5 2.5 0 00-5 0V16.5a.75.75 0 01-1.5 0v-.75a3.997 3.997 0 011.352-3.129l.87-.518a.75.75 0 10-.756-1.298l-.87.518A2.501 2.501 0 005 10.008V8.75H3.25a.75.75 0 010-1.5H5V5.752a2.501 2.501 0 001.352 2.165l.87.518a.75.75 0 10.756-1.298l-.87-.518A3.997 3.997 0 016.5 3.5V2.75a.75.75 0 011.5 0V3.5a2.5 2.5 0 005 0V2.75a.75.75 0 011.5 0V3.5a3.997 3.997 0 01-1.352 3.129l-.87.518a.75.75 0 00.756 1.298l.87-.518A2.501 2.501 0 0015 5.752V7.25h1.75z" clip-rule="evenodd" /></svg>
                        Overview
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="prerequisites">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 4.293a1 1 0 010 1.414L10 12.414l-3.293-3.293a1 1 0 011.414-1.414L10 9.586l2.293-2.293a1 1 0 011.414 0L17.293 4.293zM3 7a1 1 0 011-1h8a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h8a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h4a1 1 0 110 2H4a1 1 0 01-1-1z" /></svg>
                        Prerequisites
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="setup">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 3a1 1 0 011-1h14a1 1 0 011 1v8a1 1 0 01-1 1h-4.586l-2.707 2.707a1 1 0 01-1.414 0L5.586 12H1a1 1 0 01-1-1V3zm13 1H4v6h9V4z" clip-rule="evenodd" /></svg>
                        Project Setup
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M3.5 5.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM6.5 6A1.5 1.5 0 105 4.5a1.5 1.5 0 001.5 1.5zM11 4.5A1.5 1.5 0 109.5 6a1.5 1.5 0 001.5-1.5zM14.5 5.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16 10a1 1 0 00-1 1v1.586l-1.293-1.293a1 1 0 00-1.414 1.414L14.586 15H13a1 1 0 100 2h1.586l-2.293 2.293a1 1 0 001.414 1.414L16 18.414V20a1 1 0 102 0v-1.586l2.293 2.293a1 1 0 001.414-1.414L19.414 17H21a1 1 0 100-2h-1.586l2.293-2.293a1 1 0 00-1.414-1.414L18 12.586V11a1 1 0 00-1-1h-1zm-8 0a1 1 0 00-1 1v1.586L5.707 11.293a1 1 0 00-1.414 1.414L6.586 15H5a1 1 0 100 2h1.586l-2.293 2.293a1 1 0 101.414 1.414L8 18.414V20a1 1 0 102 0v-1.586l2.293 2.293a1 1 0 101.414-1.414L11.414 17H13a1 1 0 100-2h-1.586l2.293-2.293a1 1 0 10-1.414-1.414L10 12.586V11a1 1 0 00-1-1H8z" /></svg>
                        Docker Wrapper
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="models">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z" /></svg>
                        Models & Components
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="troubleshooting">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                        Troubleshooting
                    </button>
                     <button class="tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md" data-tab="advanced">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.54.886.061 2.042 2.106 2.106 1.372.836 2.942-.734 2.106-2.106a1.532 1.532 0 012.287-.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287.947c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042.947-2.287 1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.54-.886-.061-2.042-2.106-2.106-1.372-.836-2.942.734-2.106 2.106a1.532 1.532 0 01-2.287.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
                        Advanced
                    </button>
                </nav>
            </div>

            <div id="overview" class="tab-content active space-y-4">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Welcome to the Loghi Sittard Archive Guide</h2>
                <p>Loghi is a set of tools for Handwritten Text Recognition (HTR). This fork is specifically adapted for the Sittard Archive.</p>
                <p>This interactive guide provides an overview of the project, setup instructions, and usage guidelines, with a particular focus on the `docker-wrapper` for streamlined deployment and automated processing.</p>
                <div class="info-box">
                    <h3 class="font-semibold text-blue-700 mb-1">Key Project Components:</h3>
                    <ul class="list-disc list-inside text-stone-700 space-y-1">
                        <li>Core Loghi tools for HTR (via Git submodules).</li>
                        <li>Scripts for running the HTR pipeline (`na-pipeline.sh`, `workspace_na_pipeline.sh`).</li>
                        <li>A `docker-wrapper` to manage the pipeline in a Docker-in-Docker (DinD) environment with cron-based automation and GPU support.</li>
                        <li>Configuration files and Dockerfiles for building and running the necessary components.</li>
                    </ul>
                </div>
                <p>The two key scripts central to the processing workflow are:</p>
                <ul class="list-disc list-inside text-stone-700 space-y-1 pl-4">
                    <li><strong class="font-medium">`workspace_na_pipeline.sh`</strong>: Orchestrates the processing of image directories from a defined input path, designed to be run by cron within the `loghi-wrapper` container.</li>
                    <li><strong class="font-medium">`na-pipeline.sh`</strong>: Executes the individual steps of the HTR pipeline (layout analysis, text recognition, post-processing) using Loghi's component Docker images. This script is called by `workspace_na_pipeline.sh`.</li>
                </ul>
                 <p class="mt-4">For the source code and to contribute, please visit the <a href="#" id="repoLink" class="text-blue-600 hover:text-blue-800 underline">project repository on GitHub</a> (link to be updated).</p>
            </div>

            <div id="prerequisites" class="tab-content space-y-4">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Prerequisites</h2>
                <p>Before you begin, ensure you have the following software installed and configured on your host machine:</p>
                <ul class="space-y-3">
                    <li class="p-4 border border-stone-200 rounded-md shadow-sm">
                        <div class="flex items-start">
                            <input id="docker-check" type="checkbox" class="h-5 w-5 text-blue-600 border-stone-300 rounded focus:ring-blue-500 mt-1 mr-3">
                            <div>
                                <label for="docker-check" class="font-medium text-stone-900">Docker</label>
                                <p class="text-stone-600 text-sm">Required to build and run all components.
                                    <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Official Docker Installation Guide &rarr;</a>
                                </p>
                            </div>
                        </div>
                    </li>
                    <li class="p-4 border border-stone-200 rounded-md shadow-sm">
                        <div class="flex items-start">
                            <input id="nvidia-check" type="checkbox" class="h-5 w-5 text-blue-600 border-stone-300 rounded focus:ring-blue-500 mt-1 mr-3">
                            <div>
                                <label for="nvidia-check" class="font-medium text-stone-900">NVIDIA GPU & Drivers (for GPU acceleration)</label>
                                <ul class="list-disc list-inside text-stone-600 text-sm mt-1 space-y-0.5">
                                    <li>NVIDIA drivers installed on the host machine.</li>
                                    <li>NVIDIA Container Toolkit (nvidia-docker2) installed on the host.
                                        <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Installation Guide &rarr;</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="p-4 border border-stone-200 rounded-md shadow-sm">
                        <div class="flex items-start">
                            <input id="git-check" type="checkbox" class="h-5 w-5 text-blue-600 border-stone-300 rounded focus:ring-blue-500 mt-1 mr-3">
                             <div>
                                <label for="git-check" class="font-medium text-stone-900">Git</label>
                                <p class="text-stone-600 text-sm">For cloning the repository and managing submodules.
                                    <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Git Installation Guide &rarr;</a>
                                </p>
                            </div>
                        </div>
                    </li>
                    <li class="p-4 border border-stone-200 rounded-md shadow-sm">
                         <div class="flex items-start">
                            <input id="bash-check" type="checkbox" class="h-5 w-5 text-blue-600 border-stone-300 rounded focus:ring-blue-500 mt-1 mr-3">
                            <div>
                                <label for="bash-check" class="font-medium text-stone-900">Bash Shell</label>
                                <p class="text-stone-600 text-sm">For running the provided shell scripts. (Usually available by default on Linux/macOS, can be installed on Windows via WSL or Git Bash).</p>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>

            <div id="setup" class="tab-content space-y-6">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Project Setup</h2>
                <div>
                    <h3 class="text-xl font-medium text-stone-700 mb-2">1. Clone the Repository</h3>
                    <p class="mb-2">Replace `YOUR_FORK_USERNAME/loghi-sittard.git` with the actual URL of your fork.</p>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code>git clone git@github.com:YOUR_FORK_USERNAME/loghi-sittard.git
cd loghi-sittard</code></pre>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-medium text-stone-700 mb-2">2. Initialize Git Submodules</h3>
                    <p class="mb-2">The project relies on several submodules for core Loghi functionalities (`loghi-htr`, `loghi-tooling`, `laypa`, `prima-core-libs`). These will be mounted into the `loghi-wrapper` container if their paths are correctly specified in `docker-wrapper/.env`.</p>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code>git submodule update --init --recursive</code></pre>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-medium text-stone-700 mb-2">Simplified Project Directory Structure</h3>
                    <p class="mb-2">After setup, your project directory will look something like this (key parts):</p>
                    <div class="code-block bg-stone-700 text-stone-100">
                        <pre><code>loghi-sittard/
├── docker/                     # Dockerfiles for Loghi components
├── docker-wrapper/             # Main wrapper for deployment
│   ├── Dockerfile              # Wrapper Dockerfile
│   ├── docker-compose.yml      # Orchestrates the wrapper
│   └── .env                    # (You create this) Environment config
├── laypa/                      # Git submodule for layout analysis
├── loghi-htr/                  # Git submodule for HTR
├── loghi-tooling/              # Git submodule for tooling
├── prima-core-libs/            # Git submodule for core libraries
├── na-pipeline.sh              # Core HTR pipeline script
├── workspace_na_pipeline.sh    # Wrapper's main processing script
├── build-docker-wrapper.sh     # Script to build the wrapper image
└── README.md                   # This guide!
</code></pre>
                    </div>
                </div>
            </div>

            <div id="wrapper" class="tab-content space-y-6">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Docker Wrapper for Automated Processing</h2>
                <p>The `docker-wrapper` provides an encapsulated environment for running the entire HTR pipeline. It uses Docker-in-Docker (DinD) to manage Loghi's component containers and includes a cron job for automated processing of new images.</p>

                <div class="p-4 bg-blue-50 border border-blue-200 rounded-md">
                    <h3 class="text-lg font-semibold text-blue-700 mb-2">Docker Wrapper Features:</h3>
                    <ul class="list-disc list-inside text-stone-700 space-y-1">
                        <li>Simplified Deployment: Runs the entire pipeline within a controlled Docker environment.</li>
                        <li>Docker-in-Docker (DinD): Manages Loghi's component Docker images.</li>
                        <li>Configuration via `.env`: Pipeline behavior, paths, and cron schedule are configured using `docker-wrapper/.env`.</li>
                        <li>Automated Processing with Cron: Automatically processes new image directories.</li>
                        <li>GPU Support: Leverages NVIDIA GPUs for faster processing.</li>
                        <li>Flexible Submodule & Model Management: Mounts local submodule directories.</li>
                        <li>Structured Logging: Generates detailed logs for pipeline runs.</li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-xl font-medium text-stone-700 mt-6 mb-2">4.1. Configuration (`docker-wrapper/.env` Explorer)</h3>
                    <p class="mb-2">Create a `.env` file in the `docker-wrapper/` directory. Below are key variables and their purpose. Click on a variable to see details.</p>
                    <div id="envVarList" class="space-y-1"></div>
                    <div id="envVarDetailsContainer" class="mt-3 p-4 rounded-md hidden"></div>
                    <p class="text-sm text-stone-600 mt-3"><strong>Important:</strong> Adjust `WORKSPACE_PATH` and `DESTINATION_PATH` to <strong>absolute paths</strong> on your host. Ensure `*_MODULE` paths correctly point to your local submodule directories (relative to `docker-wrapper/` or absolute).</p>
                </div>

                <div>
                    <h3 class="text-xl font-medium text-stone-700 mt-6 mb-2">4.2. Workflow Visualizer</h3>
                    <p class="mb-3">This diagram illustrates the simplified data flow when using the Docker Wrapper:</p>
                    <div class="flex flex-col md:flex-row items-center justify-around space-y-4 md:space-y-0 md:space-x-2 p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="workflow-step">Host Machine:<br><strong class="font-mono">WORKSPACE_PATH</strong><br>(Input Images)</div>
                        <div class="workflow-arrow text-3xl font-bold">&rarr;</div>
                        <div class="workflow-step">`loghi-wrapper` Container<br>(Cron + `workspace_na_pipeline.sh`)</div>
                        <div class="workflow-arrow text-3xl font-bold">&rarr;</div>
                        <div class="workflow-step">Loghi Component Containers<br>(Laypa, HTR, Tooling via `na-pipeline.sh`)</div>
                        <div class="workflow-arrow text-3xl font-bold">&rarr;</div>
                        <div class="workflow-step">Host Machine:<br><strong class="font-mono">DESTINATION_PATH</strong><br>(Processed Output)</div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-medium text-stone-700 mt-6 mb-2">4.3. Setup and Usage Steps</h3>
                    <ol class="list-decimal list-inside space-y-4 pl-4">
                        <li>
                            <strong>Navigate to Docker Wrapper Directory:</strong>
                            <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code>cd docker-wrapper</code></pre>
                            </div>
                        </li>
                        <li>
                            <strong>Configure Environment:</strong> Create and edit `docker-wrapper/.env` as described in the `.env Explorer` section.
                        </li>
                        <li>
                            <strong>Prepare Host Directories:</strong> Ensure `WORKSPACE_PATH`, `DESTINATION_PATH`, and submodule paths exist and have correct permissions.
                            <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code># Example:
mkdir -p /mnt/archive_scans/loghi_input
mkdir -p /mnt/archive_scans/loghi_output</code></pre>
                            </div>
                        </li>
                        <li>
                            <strong>Build Docker Wrapper Image (if needed):</strong>
                            <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code># From project root (e.g., loghi-sittard/)
./build-docker-wrapper.sh</code></pre>
                            </div>
                        </li>
                        <li>
                            <strong>Start Docker Wrapper Service:</strong>
                            <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code># From docker-wrapper/ directory
docker-compose up -d</code></pre>
                            </div>
                            <p class="text-sm text-stone-600 mt-1">This starts the service in detached mode. Cron will begin processing based on `CRON_SCHEDULE`.</p>
                        </li>
                        <li>
                            <strong>Process Images:</strong> Place image directories into your `WORKSPACE_PATH` on the host.
                        </li>
                        <li>
                            <strong>Monitor and View Logs:</strong>
                            <ul class="list-disc list-inside text-sm text-stone-600 space-y-1 mt-1 pl-4">
                                <li>Wrapper container logs: `docker-compose logs -f loghi-wrapper`</li>
                                <li>Pipeline script logs: In volume `loghi_wrapper_logs` (find host path via `docker volume inspect loghi_wrapper_logs`). Path inside container: `/app/logs/run_YYYYMMDD_HHMMSS_PID/`.</li>
                                <li>Cron job output: `/app/logs/pipeline_cron_runs.log` (in `loghi_wrapper_logs` volume).</li>
                                <li>Internal Docker daemon: `/var/log/dockerd.log` (inside wrapper container).</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Stopping the Wrapper:</strong>
                            <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code># From docker-wrapper/ directory
docker-compose down

# To also remove volumes (logs, Docker storage):
# docker-compose down -v</code></pre>
                            </div>
                        </li>
                    </ol>
                </div>
                <div>
                    <h3 class="text-xl font-medium text-stone-700 mt-6 mb-2">4.4. Manual Pipeline Execution (for Debugging)</h3>
                     <p class="mb-2">While designed for automation, you can manually trigger processing:</p>
                    <ol class="list-decimal list-inside space-y-2 pl-4">
                        <li>Ensure wrapper is running: `docker-compose up -d`.</li>
                        <li>Place test data in `WORKSPACE_PATH` on host (e.g., `/workspace/my_test_batch` inside container).</li>
                        <li>Execute `workspace_na_pipeline.sh`:
                            <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code>docker exec &lt;loghi-wrapper_container_name_or_id&gt; /bin/bash /app/workspace_na_pipeline.sh /workspace /destination</code></pre>
                                <p class="text-xs text-stone-400 mt-1">Replace `&lt;loghi-wrapper_container_name_or_id&gt;` (find with `docker ps`).</p>
                            </div>
                        </li>
                        <li>To test `na-pipeline.sh` directly (requires data manually placed in container):
                             <div class="code-block mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code># Example:
# 1. Copy data to e.g. /tmp/manual_test/ inside container
docker exec &lt;container_id&gt; /bin/bash /app/na-pipeline.sh /tmp/manual_test /tmp/manual_output true true</code></pre>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>

            <div id="models" class="tab-content space-y-4">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Models & Components</h2>
                <div>
                    <h3 class="text-lg font-medium text-stone-700 mb-1">Loghi Component Docker Images</h3>
                    <p>The HTR pipeline uses several Docker images (e.g., `loghi/docker.laypa`, `loghi/docker.htr`, `loghi/docker.loghi-tooling`).</p>
                    <ul class="list-disc list-inside pl-4 mt-2 space-y-2">
                        <li>
                            <strong>Pulling from Docker Hub (Recommended):</strong> Scripts attempt to pull these. Manual pull:
                            <div class="code-block text-sm mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code>docker pull loghi/docker.laypa:1.3.7
docker pull loghi/docker.htr:1.3.7
docker pull loghi/docker.loghi-tooling:1.3.7</code></pre>
                                <p class="text-xs text-stone-400 mt-1">`na-pipeline.sh` specifies version `1.3.7`. Adjust if needed.</p>
                            </div>
                        </li>
                        <li>
                            <strong>Building Locally (Development):</strong> From submodule sources:
                            <div class="code-block text-sm mt-1">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code>git submodule update --init --recursive
cd docker
./buildAll.sh
cd ..</code></pre>
                            </div>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-stone-700 mt-4 mb-1">Inference Models</h3>
                    <p>The pipeline requires pre-trained models for:</p>
                    <ul class="list-disc list-inside pl-4">
                        <li><strong>Laypa Model:</strong> For layout analysis (baseline detection).</li>
                        <li><strong>Loghi-HTR Model:</strong> For handwritten text recognition.</li>
                    </ul>
                    <p class="mt-2">Download models from the original Loghi project (verify link validity): <a href="https://surfdrive.surf.nl/files/index.php/s/YA8HJuukIUKznSP" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Loghi Models Download &rarr;</a></p>
                    <p class="mt-2">Place extracted models where the pipeline can access them. Default paths in `na-pipeline.sh` (relative to `/app` inside containers, typically mounted from host submodules):</p>
                    <ul class="list-disc list-inside pl-4 text-sm font-mono mt-1">
                        <li>`LAYPAMODEL="${BASEDIR}/laypa/general/baseline/config.yaml"`</li>
                        <li>`HTRLOGHIMODEL="${BASEDIR}/loghi-htr/generic-2023-02-15"`</li>
                    </ul>
                     <p class="text-sm text-stone-600 mt-1">When using the Docker wrapper, these models are usually located within the mounted submodule directories (e.g., `../../laypa/general/baseline/` on host becomes `/app/laypa/general/baseline/` in container).</p>
                </div>
            </div>

            <div id="troubleshooting" class="tab-content space-y-3">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Troubleshooting Guide</h2>
                <p class="mb-4">Common issues and how to address them:</p>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">Permissions Errors</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Ensure host directories mapped as volumes (`WORKSPACE_PATH`, `DESTINATION_PATH`, submodule paths) have correct read/write permissions for the user running Docker.</li>
                            <li>The `loghi-wrapper` entrypoint attempts to `chown` some internal directories. If errors persist for `/workspace` or `/destination`, double-check host permissions.</li>
                        </ul>
                    </div>
                </details>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">"Docker daemon is NOT responsive" (in `na-pipeline.sh` logs)</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>This indicates the Docker-in-Docker daemon inside `loghi-wrapper` failed or crashed.</li>
                            <li>Check `loghi-wrapper` container logs: `docker-compose logs loghi-wrapper`.</li>
                            <li>Check internal dockerd log: `docker exec &lt;wrapper_id&gt; cat /var/log/dockerd.log`.</li>
                        </ul>
                    </div>
                </details>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">NVIDIA GPU Issues</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Verify NVIDIA drivers are correctly installed on the host (`nvidia-smi`).</li>
                            <li>Verify NVIDIA Container Toolkit is installed and configured on the host.</li>
                            <li>Check `docker-compose logs loghi-wrapper` for GPU-related errors during startup.</li>
                        </ul>
                    </div>
                </details>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">Submodule Paths Incorrect</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Double-check `*_MODULE` paths in `docker-wrapper/.env`. They should be relative to `docker-wrapper/` or absolute host paths.</li>
                            <li>If submodules aren't found, the pipeline might fail or use incorrect/outdated versions.</li>
                        </ul>
                    </div>
                </details>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">Script Not Executable Errors</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Error like `ERROR: Script not executable: /app/na-pipeline.sh`.</li>
                            <li>Ensure scripts (`na-pipeline.sh`, `workspace_na_pipeline.sh`, `xml2text.sh`) have execute permissions in your Git repository (e.g., `git update-index --chmod=+x na-pipeline.sh`).</li>
                        </ul>
                    </div>
                </details>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">Stale Lock Files</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>`workspace_na_pipeline.sh` uses `/tmp/workspace_na_pipeline.lock` (inside wrapper).</li>
                            <li>If a run crashes, this might remain. The script has some handling, but manual removal might be needed: `docker exec &lt;wrapper_id&gt; rm /tmp/workspace_na_pipeline.lock`.</li>
                        </ul>
                    </div>
                </details>
                 <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">Cron Job Not Running</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Check `docker-compose logs loghi-wrapper` for cron service startup messages.</li>
                            <li>Verify `CRON_SCHEDULE` in `.env` is valid.</li>
                            <li>Check `/app/logs/pipeline_cron_runs.log` (in `loghi_wrapper_logs` volume) for cron execution attempts.</li>
                        </ul>
                    </div>
                </details>
                <details class="troubleshooting-item bg-white border border-stone-200 rounded-md shadow-sm">
                    <summary class="text-stone-700">XMLStarlet Errors (in `xml2text.sh` logs)</summary>
                    <div class="p-4 text-sm text-stone-600 border-t border-stone-200">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Ensure `xmlstarlet` is installed in the `loghi-wrapper` image (it is by default).</li>
                            <li>If text extraction fails, the PAGE XML structure might not match expected formats/namespaces.</li>
                        </ul>
                    </div>
                </details>
            </div>

            <div id="advanced" class="tab-content space-y-4">
                <h2 class="text-2xl font-semibold text-stone-800 mb-3">Advanced Topics</h2>
                <div>
                    <h3 class="text-lg font-medium text-stone-700 mb-1">Training New Models</h3>
                    <p>The script `na-pipeline-train.sh` is provided for training new models. Detailed instructions for training are beyond the scope of this quick start guide and depend on the specific Loghi training procedures. Consult the original Loghi documentation or specific training guides for comprehensive information on data preparation, training configurations, and model evaluation.</p>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-stone-700 mt-4 mb-1">Further Customization</h3>
                    <ul class="list-disc list-inside pl-4 space-y-1">
                        <li><strong>Pipeline Steps:</strong> Modify `na-pipeline.sh` to change models, parameters, or enable/disable specific processing steps (Laypa, HTR, post-processing minions).</li>
                        <li><strong>Docker Images:</strong> Update component Dockerfiles in the `docker/` directory or the `docker-wrapper/Dockerfile` for custom dependencies or versions. Remember to rebuild the images after changes.</li>
                        <li><strong>Cron Behavior:</strong> Adjust `CRON_SCHEDULE` in `docker-wrapper/.env` for different processing frequencies. For more complex scheduling logic, you might need to modify `workspace_na_pipeline.sh` or the cron setup within the `loghi-wrapper` container.</li>
                    </ul>
                </div>
                 <div class="mt-6 p-4 bg-stone-100 border border-stone-200 rounded-md">
                    <p class="text-sm text-stone-700">This README provides a guide for the Sittard Archive fork of Loghi. For foundational Loghi concepts and more in-depth technical details, please refer to the original Loghi project documentation.</p>
                </div>
            </div>

        </div>
        <footer class="text-center text-sm text-stone-500 mt-12 py-4 border-t border-stone-200">
            Interactive Guide for Loghi Sittard Archive.
        </footer>
    </div>

<script>
    const tabs = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    const repoLink = document.getElementById('repoLink');

    // Placeholder for actual repo URL
    const GITHUB_REPO_URL = "https://github.com/YOUR_FORK_USERNAME/loghi-sittard"; // TODO: Update this

    if (repoLink) {
        repoLink.href = GITHUB_REPO_URL;
    }


    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(item => item.classList.remove('active'));
            tab.classList.add('active');

            const targetTab = tab.getAttribute('data-tab');
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === targetTab) {
                    content.classList.add('active');
                }
            });
        });
    });

    function copyCode(button) {
        const codeBlock = button.parentElement;
        const pre = codeBlock.querySelector('pre');
        let code = pre.innerText;
        
        // For code blocks that might have an additional small text note inside pre
        const smallNote = pre.querySelector('p.text-xs');
        if (smallNote) {
            code = code.replace(smallNote.innerText, '').trim();
        }

        navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = 'Copy';
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            button.textContent = 'Failed';
             setTimeout(() => {
                button.textContent = 'Copy';
            }, 2000);
        });
    }

    // .env Explorer
    const envVariables = [
        { name: "TZ", example: "Europe/Amsterdam", description: "Sets the timezone for the container." },
        { name: "CRON_SCHEDULE", example: "*/15 * * * *", description: "Defines how often the pipeline script will run (cron format). Example: '*/15 * * * *' for every 15 minutes." },
        { name: "COPY_SOURCE_IMAGES", example: "true", description: "Set to 'true' to copy original source images to the final destination, 'false' otherwise. Passed to na-pipeline.sh." },
        { name: "COPY_BASELINE_IMAGES", example: "true", description: "Set to 'true' to copy generated baseline images (PNGs from 'page' dir) to final destination. Passed to na-pipeline.sh." },
        { name: "REMOVE_PROCESSED_DIRS", example: "true", description: "Set to 'true' to remove input subdirectories from WORKSPACE_PATH after successful processing by workspace_na_pipeline.sh." },
        { name: "PIPELINE_ENABLE_DEBUG_LOGGING", example: "false", description: "Set to 'true' for more verbose logging from workspace_na_pipeline.sh." },
        { name: "PIPELINE_KEEP_TEMP_RUN_DIR", example: "false", description: "Set to 'true' to keep temporary processing directories (under /tmp in wrapper) for debugging." },
        { name: "LAYPA_MODULE", example: "../../laypa", description: "Path on the HOST to your Laypa Git submodule. Relative to docker-compose.yml or absolute." },
        { name: "LOGHI_HTR_MODULE", example: "../../loghi-htr", description: "Path on the HOST to your Loghi-HTR Git submodule." },
        { name: "LOGHI_TOOLING_MODULE", example: "../../loghi-tooling", description: "Path on the HOST to your Loghi Tooling Git submodule." },
        { name: "PRIMA_CORE_LIBS_MODULE", example: "../../prima-core-libs", description: "Path on the HOST to your Prima Core Libs Git submodule." },
        { name: "WORKSPACE_PATH", example: "/mnt/archive_scans/loghi_input", description: "ABSOLUTE path on your HOST machine for input image directories." },
        { name: "DESTINATION_PATH", example: "/mnt/archive_scans/loghi_output", description: "ABSOLUTE path on your HOST machine for processed output." }
    ];

    const envVarListEl = document.getElementById('envVarList');
    const envVarDetailsContainerEl = document.getElementById('envVarDetailsContainer');

    if (envVarListEl && envVarDetailsContainerEl) {
        envVariables.forEach(variable => {
            const itemEl = document.createElement('div');
            itemEl.classList.add('p-2', 'border', 'border-stone-200', 'rounded', 'env-var-item', 'hover:bg-stone-50');
            itemEl.textContent = variable.name;
            itemEl.onclick = () => {
                envVarDetailsContainerEl.innerHTML = `
                    <h4 class="font-semibold text-stone-700">${variable.name}</h4>
                    <p class="text-sm text-stone-600 mt-1">${variable.description}</p>
                    <p class="text-sm text-stone-500 mt-1">Example: <code class="bg-stone-200 px-1 rounded">${variable.example}</code></p>
                `;
                envVarDetailsContainerEl.classList.remove('hidden');
                envVarDetailsContainerEl.classList.add('env-var-details');

                document.querySelectorAll('.env-var-item').forEach(el => el.classList.remove('bg-blue-100', 'border-blue-300'));
                itemEl.classList.add('bg-blue-100', 'border-blue-300');

            };
            envVarListEl.appendChild(itemEl);
        });
    }

    // Initialize with the first tab active
    if (tabs.length > 0) {
        tabs[0].click();
    }
</script>

</body>
</html>
